<h1>Nova Atividade</h1>
<div id="result"></div>
<%= form_with url: classroom_tasks_path do |f| %>

  <%= f.label :grade_level %>
  <%= f.select :grade_level, Task.grade_levels.keys.map { |grade| [grade.to_s.humanize, grade] }, id: 'gradeLevel' %><br>

  <%= f.label 'Conteúdo' %>
  <%= f.text_area :content,size: "50x10", id: 'textArea' %><br>

  <%= f.submit "Criar Tarefa" %>
  <button type="button" onclick="countWordsSentencesSyllables()">Avaliar</button><br><br>
<% end %>

<br>

<script>
function countWordsSentencesSyllables() {
    var text = document.getElementById('textArea').value;
    var wordCount = text.trim().split(/\s+/).length;
    var sentenceCount = text.trim().split(/[.!?]+/).length - 1;
    var syllableCount = countSyllables(text);
    var flesh_kincaid_reading_ease = 206.835-(1.015*(wordCount/sentenceCount))-(84.6*(syllableCount/wordCount))
    var grade_level = document.getElementById('grade_level').value;
    

    document.getElementById('result').innerHTML = "<strong>Quantidade de palavras:</strong> " + wordCount + "<br>" +
                                                    "<strong>Quantidade de Sentenças:</strong> " + sentenceCount + "<br>" +
                                                    "<strong>Quantidade de Silabas:</strong> " + syllableCount + "<br>" +
                                                    "<strong>Flesch reading ease:</strong> " + flesh_kincaid_reading_ease.toFixed(2) + "<br>" +
                                                     "<strong>Quantidade de Silabas:</strong> " + grade_level;
}

function countSyllables(word) {
    word = word.toLowerCase().replace(/[^a-z]/g, ''); // Remove non-alphabetic characters
    if (word.length <= 3) return 1; // Words of 3 letters or fewer are 1 syllable
    word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, ''); // Remove common suffixes
    word = word.replace(/^y/, ''); // Remove initial y
    return word.match(/[aeiouy]{1,2}/g).length; // Count the remaining vowel sequences
}
</script>